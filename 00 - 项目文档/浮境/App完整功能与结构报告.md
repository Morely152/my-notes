这是一份**从 MVP 到正式版**的完整产品蓝图。我会把「核心功能」（必须 4 周做完）和「社区功能」（正式版再上线）分开展示，让你一眼看清阶段目标。

---

## 一、产品定位与核心目标

**一句话定位**：一款让用户「点开即睡」的 AI 助眠 App，通过虚拟氛围混音 + 个性化催眠故事，解决失眠者的入睡焦虑。

**核心目标**：

- **短期（MVP）**：验证「AI 生成故事 + 语音朗读」是否真能让用户睡着，并愿意付费。
- **长期（正式版）**：通过社区产生 UGC 故事池，降低 AI 生成成本，提升留存与传播。

---

## 二、完整功能架构图（模块化设计）

```
┌─────────────────────────────────────────────────────────────────
│                         浮境 App Layer                           
├─────────────────────────────────────────────────────────────────
│ 1️⃣ 氛围播放器层（核心入口）                                         
│    ├─ 快捷预设（4 个）                                             
│    ├─ 自定义混音（8 轨，默认折叠）                                   
│    └─ 定时关闭（15/30/60/90 min + 智能停播）                        
│                                                                 
│ 2️⃣ AI 故事生成层（核心付费点）                                 
│    ├─ 快速生成（300 字，约 15 分钟）                           
│    ├─ 长故事模式（分段续写，1-1.5 小时）                        
│    ├─ 15 秒试听（确认后扣额度）                                 
│    └─ 历史记录（自动保存 30 天）                                
│                                                                 
│ 3️⃣ 额度系统层（变现核心）                                      
│    ├─ 每日任务（签到 + 看广告）                                 
│    ├─ 额度充值（¥1=3 次，¥6=20 次，¥30=120 次）               
│    ├─ 月卡订阅（¥12/月，无限次）                               
│    └─ 消费流水（透明可查）                                      
│                                                                 
│ 4️⃣ 社区层（正式版功能）                                        
│    ├─ 故事广场（推荐/最新/热门）                                
│    ├─ 发布作品（一键发布生成的故事）                            
│    ├─ 点赞/收藏（轻度互动）                                     
│    ├─ 作者分成（被官方推荐得 10% 额度）                         
│    └─ 内容审核（机审 + 人工抽检）                               
│                                                                 
│ 5️⃣ 个人中心层（最小化）                                        
│    ├─ 设置（音质/暗黑模式/清理缓存）                            
│    ├─ 我的故事（仅自己生成的）                                  
│    └─ 关于（版本/隐私协议）                                    
└─────────────────────────────────────────────────────────────────
```

---

## 三、详细功能设计（每个功能都有用）

### 1️⃣ 氛围播放器（首页）

**设计哲学**：90% 的用户只想「点开就睡」，所以默认只显示 4 个预设按钮，复杂功能全部折叠。

| 功能          | 交互                            | 有什么用                 | 边界处理                              |
| :---------- | :---------------------------- | :------------------- | :-------------------------------- |
| **4 个预设按钮** | 单击即播；长按进入编辑模式                 | 2 步操作，0 思考，闭眼都能点     | 预设配置存 `assets/presets.json`，无网也能播 |
| **播放/暂停**   | 单击；切后台/锁屏继续播；来电自动停            | 助眠场景不能让用户找按钮         | 监听系统电话广播，暂停后 10s 自动恢复             |
| **定时器**     | 默认 15 min，可点图标改成 30/60/90 min | 防止播一整晚，省电省流量         | 最大 120 min，最小 5 min               |
| **音量滑杆**    | 拖动；支持系统音量键联动                  | 防止突然大声惊醒用户           | 每次启动默认 40%，不记忆上次（防忘调）             |
| **自定义混音**   | 点击「⚙️」展开 8 轨滑杆                | 满足 5% 发烧友，但默认不打扰普通用户 | 调整即生效，退出页自动重置，不设保存按钮              |
| **智能停播**    | 用加速度计检测用户翻身/放手机，连续 3 分钟不动自动停播 | 防止用户睡着后一直播放          | 灵敏度可调，默认中                         |

**技术实现要点**：

- **音频引擎**：`flutter_sound` 开 8 个 `FlutterSoundPlayer`，混音算法用 C++ 环形缓冲区（已封装成 Dart FFI）。
- **预设配置**：

    ```json
    {
      "presets": [
        {
          "id": "rain_town",
          "name": "雷雨小镇",
          "tracks": [
            {"url": "https://cdn.com/rain.mp3", "volume": 60, "loop": true, "fadeIn": 3000},
            {"url": "https://cdn.com/fire.mp3", "volume": 40, "loop": true}
          ]
        }
      ]
    }
    ```

- **首次启动**：Wi-Fi 下自动下载前 2 个预设（约 10 MB），4G 下提示「是否下载」。

---

### 2️⃣ AI 故事生成（核心付费功能）

**设计哲学**：让用户「3 步完成生成」，每一步都有明确反馈，20 秒等待不焦虑。

**用户路径**：
`点底部「故事」Tab → 横向滑动选主题/人称/音色 → (可选)补充情节 → 点「生成故事」→ 转圈 20s → 15s 试听 → 点「确认收听」→ 播放并扣额度`

|功能|交互|有什么用|边界处理|
|:--|:--|:--|:--|
|**主题/人称/音色**|横向滑动选择，单击选中|比下拉菜单少点一次，适合睡前慵懒状态|选择后本地缓存，下次默认上次的|
|**补充情节**|折叠在「高级」，不填也能生成|降低门槛，让「懒用户」也能用|不填时 AI 完全自由发挥|
|**额度预览**|按钮下方小字「需 1 额度」|避免用户点到一半发现余额不足|若余额 < 1，按钮变灰，提示「看广告得额度」|
|**生成进度**|转圈 + 文字「AI 正在为你编织梦境...」+ 10s 后显示「别急，马上就好」|20s 等待需要安抚，防止用户退出|生成失败弹窗「网络开小差，额度已返还」|
|**15 秒试听**|生成后先放 15s，底部出现「确认收听」和「换音色」|用户可反悔，降低「生成失败」挫败感|试听不扣额度，确认后才真正扣|
|**长故事模式**|生成时可选「长故事（1 小时）」|满足深度失眠用户需求|分段生成，每 15min 自动续写，后台预加载|

**技术实现要点**：

- **生成接口**：`/v1/story/generate` 返回 `{story_id, status, eta}`，前端轮询 `/v1/story/{id}` 直到 `status=done`。
- **额度扣除**：点击「生成」时先扣币（事务），失败立即返还。
- **长故事续写**：

 ```python
   # 第 1 段：生成 300 字引子
   # 第 2-n 段：Prompt = "上文结尾：{last_5_sentences} → 请续写 300 字，保持温柔语气"
   # 用阿里云 TTS 的 SSML <break time="600s"/> 做无缝衔接
```

- **AI 模型**：GLM4.6 足够，Prompt 模板：

`"请用 {人称} 视角，写一个 {主题} 风格的 300 字睡前故事，要求温柔治愈、无暴力。{用户补充}"`

---

### 3️⃣ 额度系统（变现核心）

**设计哲学**：让免费用户「每天能玩」，让付费用户「感觉划算」，让重度用户「有月卡」。

|获取方式|奖励|每日限制|目的|
|:--|:--|:--|:--|
|**每日登录**|+1 额度|每天 1 次|培养习惯|
|**看激励视频**|+1 额度|每天 2 次|广告变现，不强制|
|**首次充值**|双倍送|仅 1 次|刺激首充|
|**月卡**|无限次 + 专属音色|30 天|重度用户转化|

**额度消耗**：

- 300 字故事：1 额度
- 600 字故事：2 额度
- 长故事（1 小时）：5 额度（分段扣）

**界面设计**：

- **额度弹层**：从首页或故事页点击「💰余额」图标弹出，用完即关，不占独立页面。
- **三大按钮**：「签到」「看广告」「充值」，纵向排列，不堆信息。
- **看广告**：点击后全屏播放 30s，不能跳过，看完立即 +1 额度并 toast 提示。

**技术实现要点**：

- **额度表**：`user_coins (user_id, balance, frozen, vip_expire, updated_at)`。
- **流水表**：`coin_flow (user_id, amount, type, story_id, created_at)`，用于对账和分成。
- **防刷**：SQLite 里 `user_ad_count` 字段 + 每日定时任务清 0（不设 Redis）。
- **月卡**：`vip_expire > NOW()` 时，生成故事不扣额度。

---

### 4️⃣ 社区层（正式版功能，MVP 不做）

**设计哲学**：社区是「内容池」而非「社交场」，只做轻度互动，不做评论/关注/私信，避免审核和运营成本爆炸。

**核心功能**：

|功能|交互|有什么用|边界处理|
|:--|:--|:--|:--|
|**故事广场**|推荐/最新/热门三栏，瀑布流|让用户发现好故事，降低自己生成的成本|推荐算法 = 完播率 70% + 点赞率 20% + 新鲜度 10%|
|**发布作品**|生成故事后，按钮「发布到社区」|激励用户创作，产生 UGC 内容池|发布后进入「审核中」状态，机审通过才可见|
|**点赞/收藏**|单击心形，双击故事卡片|轻度互动，无社交压力|点赞数仅自己可见，避免攀比|
|**作者分成**|作品被官方推荐，作者得 10% 额度|激励高质量创作|分成额度不可提现，仅用于消费|
|**内容审核**|百度文本审核 + 阿里云音频审核 + 人工抽检 10%|合规，避免涉黄涉政|违规作品下架，作者冻结额度|

**推荐算法（离线计算）**：

```python
# 每天 02:00 跑 Spark 任务
score = 0.7 * avg_play_rate + 0.2 * like_rate + 0.1 * (1 / days_since_publish)
```

- `avg_play_rate`：完播率（听完 80% 算完播）
- `like_rate`：点赞 / 浏览
- `days_since_publish`：发布天数，新作品加分

**为什么不做评论/关注/私信？**

- **审核成本**：评论区是重灾区，1 万 DAU 就需要 2 人审核团队。
- **社交压力**：助眠 App 用户想「安静」，不想社交。
- **优先级**：社区的核心是「好内容」，不是「强互动」，点赞/收藏已足够。

---

### 5️⃣ 个人中心（最小化）

**只保留 4 项**：

1. **设置**
    
    - 音质（标准 / 高品质）
    - 暗黑模式（跟随系统 / 强制）
    - 清理缓存
        
2. **我的故事**
    
    - 列表只显示「我生成的」，不显示「我收藏的」
    - 长按删除
        
3. **关于**
    
    - 版本号、隐私协议（外链）、用户协议
        
4. **退出登录**
    

**为什么不做「收藏」「历史」「喜欢」？**

- MVP 阶段，用户生成故事后**默认存「我的故事」**，已满足复听需求。
- 互动功能留到正式版，避免前期开发量。
    

---

## 四、完整技术架构（含社区）

复制

```
┌──────────────────────────────────────────────────────────────
│                     Flutter App (Dart)               
│  - UI: Material3 + Cupertino Adaptive                
│  - State: Riverpod (轻量，无冗余)                          
│  - Audio: flutter_sound (8 轨混音) + AudioService (后台)  
│  - Cache: drift (SQLite) 存用户配置/历史                    
└──────────────────────────────────────────────────────────────
                             │ HTTP API
                             ▼
┌──────────────────────────────────────────────────────────────
│               FastAPI Backend (Python)               
│  - ASGI: uvicorn (异步高性能)                              
│  - DB: SQLite (MVP) → PostgreSQL (正式版)                
│  - Cache: Redis (社区版启用，用于点赞/阅读数)               
│  - AI: GLM4.6 (MVP) → Kimi 128k (正式版)                 
│  - TTS: 阿里云 (按量计费)                                   
│  - Queue: Celery + Redis (长故事续写)                      
│  - Monitor: Sentry (崩溃追踪)                             
└──────────────────────────────────────────────────────────────
```

**MVP 阶段（4 周）**：只用左边 4 个框（App + FastAPI + SQLite + GLM4.6），**不引入 Redis/Celery/PostgreSQL**。
**正式版阶段（8 周）**：社区上线后，逐步引入 Redis（缓存点赞数）、Celery（长故事队列）、PostgreSQL（大数据量）。

---

## 五、功能优先级与里程碑

### **MVP 阶段（4 周，1 人开发）**

|周次|任务|交付物|验证指标|
|:--|:--|:--|:--|
|**Week1**|后端：用户/额度/故事生成 API|FastAPI + SQLite + 14 个 pytest 绿勾|`main_flow.py` 跑通全流程，生成 mp3|
|**Week2**|后端：支付/广告/后台管理|集成 Google/Apple/华为沙箱支付|看广告 +1 额度，充值 ¥1=3 额度|
|**Week3**|移动端：UI + 播放器 + 生成页|Flutter 三端 APK/IPA/HAP|真机 5 分钟冒烟测试通过|
|**Week4**|打包 + 商店素材 + 内测|TestFlight + 华为开放式测试链接|邀请 20 人，次日留存 > 30%|

**MVP 不做**：社区、长故事、音色克隆、多人有声剧。

---

### **正式版阶段（8 周，+1 名 UI 设计师）**

|周次|任务|交付物|验证指标|
|:--|:--|:--|:--|
|**Week5-6**|社区：故事广场 + 发布 + 点赞|社区页 UI + 推荐算法（离线 Spark）|故事发布率 > 10%，点赞率 > 5%|
|**Week7**|长故事模式 + 分段续写|后台 Celery 队列 + 流式 TTS 衔接|长故事完播率 > 40%|
|**Week8**|社区审核 + 作者分成 + 商店上架|AppGallery + Google Play 正式版|3 端过审，DAU > 1000|

---

## 六、数据埋点与验证指标

### **MVP 核心指标**（必须追踪）

- **次日留存**：> 30%（助眠 App 基准线）
- **故事生成率**：DAU 的 40%（证明 AI 功能有价值）
- **广告完成率**：> 70%（证明激励视频不反感）
- **首次付费率**：> 2%（证明定价合理）

### **正式版社区指标**

- **UGC 发布率**：生成故事的 15% 会发布到社区
- **社区阅读占比**：> 30% 的故事消费来自社区而非自己生成
- **作者分成激活**：> 5% 用户为分成额度而主动发布

### **埋点方案**

- **客户端**：Firebase Analytics（免费，无后端代码）

  ```dart
    // 埋点示例
    FirebaseAnalytics.logEvent(name: "story_generate", parameters: {
      "theme": "童话",
      "voice": "xiaoyun",
      "cost": 1,
    });
    ```

- **服务端**：每生成一条故事，写日志 `logger.info(f"user={user_id}, cost={cost}")`
- **分析**：每周手动拉日志进 Excel 透视表，MVP 阶段不建 BI。

---

## 七、成本与盈利模型

### **MVP 运行成本（1000 DAU）**

|项目|成本/月|说明|
|:--|:--|:--|
|云服务器|99 元|2 核 4G，轻量应用服务器|
|GLM4.6 调用|120 元|1000 用户 × 1 次/天 × 0.004 元|
|阿里云 TTS|300 元|1000 次/天 × 0.01 元|
|CDN 音频|50 元|氛围音频 50 GB 回源|
|**总计**|**569 元**||

### **收入预估（1000 DAU）**

|来源|转化率|收入/月|说明|
|:--|:--|:--|:--|
|看广告|70% 用户 × 2 次/天|400 元|激励视频 eCPM ¥20|
|充值|2% 用户 × ¥6/人|120 元|人均充值 6 元|
|**总计**||**520 元**|接近打平，略有亏损|

**扭亏为盈关键**：社区上线后，**30% 用户阅读 UGC，降低 AI 调用**，成本降至 300 元/月，实现盈利。

---

## 八、最终交付物清单

### **MVP 交付（4 周后）**

- ✅ Android APK（arm64-v8a, 18 MB）
- ✅ iOS TestFlight 外测链接（20 人）
- ✅ 鸿蒙 HAP（20 MB）
- ✅ 后端单文件 `main.py` + SQLite
- ✅ 管理后台（FastAPI-Admin，单文件）
- ✅ 商店素材（7 张截图 + 中英描述）
- ✅ 数据指标报告（100 人内测留存）

### **正式版交付（8 周后）**

- ✅ Google Play + AppGallery 正式版过审
- ✅ 社区功能（故事广场 + 发布 + 点赞）
- ✅ 长故事模式（分段续写）
- ✅ 作者分成系统（额度到账）
- ✅ DAU > 1000，次日留存 > 35%

---

## 九、一句话总结

**浮境 = 氛围播放器（0 思考） + AI 故事生成（20 秒） + 额度系统（看广告能玩） + 社区（正式版内容池）**。  
MVP 阶段砍掉社区，4 周上线验证核心；正式版加回社区，8 周实现盈利。

你现在可以清楚地看到：

1. **每个功能的存在理由**（解决什么用户痛点）
2. **每个功能的技术实现**（用什么库，多少代码量）
3. **每个功能的阶段归属**（MVP vs 正式版）
