---

---
--- 
## 1. 项目概述

- **项目背景**：针对现代人日益严重的入睡焦虑和失眠问题，传统助眠 App 内容固定且昂贵。本项目旨在利用 AI 生成技术，提供低成本、高度个性化的沉眠体验。
    
- **项目目标**：打造一个集成“AI 定制故事 + 多轨氛围音混音”的助眠平台。MVP 阶段验证 AI 内容的助眠效果与商业模型；正式版通过社区 UGC 降低成本并提升粘性。
    
- **项目范围**：包含 Flutter 移动客户端（iOS/Android/HarmonyOS NEXT）、后端 API 服务、AI 逻辑处理模块（LLM + TTS）以及管理后台。

```
┌─────────────────────────────────────────────────────────────────
│                         浮境 App Layer                           
├─────────────────────────────────────────────────────────────────
│ 1️⃣ 氛围播放器层（核心入口）                                         
│    ├─ 快捷预设（4 个）                                             
│    ├─ 自定义混音（8 轨，默认折叠）                                   
│    └─ 定时关闭（15/30/60/90 min + 智能停播）                        
│                                                                 
│ 2️⃣ AI 故事生成层（核心付费点）                                 
│    ├─ 快速生成（300 字，约 15 分钟）                           
│    ├─ 长故事模式（分段续写，1-1.5 小时）                        
│    ├─ 15 秒试听（确认后扣额度）                                 
│    └─ 历史记录（自动保存 30 天）                                
│                                                                 
│ 3️⃣ 额度系统层（变现核心）                                      
│    ├─ 每日任务（签到 + 看广告）                                 
│    ├─ 额度充值（¥1=3 次，¥6=20 次，¥30=120 次）               
│    ├─ 月卡订阅（¥12/月，无限次）                               
│    └─ 消费流水（透明可查）                                      
│                                                                 
│ 4️⃣ 社区层（正式版功能）                                        
│    ├─ 故事广场（推荐/最新/热门）                                
│    ├─ 发布作品（一键发布生成的故事）                            
│    ├─ 点赞/收藏（轻度互动）                                     
│    ├─ 作者分成（被官方推荐得 10% 额度）                         
│    └─ 内容审核（机审 + 人工抽检）                               
│                                                                 
│ 5️⃣ 个人中心层（最小化）                                        
│    ├─ 设置（音质/暗黑模式/清理缓存）                            
│    ├─ 我的故事（仅自己生成的）                                  
│    └─ 关于（版本/隐私协议）                                    
└─────────────────────────────────────────────────────────────────
```

## 2. 功能需求

### 2.1 氛围播放模块 (MVP 核心)

- **多轨混音引擎**：支持至少 8 路音频并发播放，用户可独立调节每路音量（雨声、白噪声、篝火等）。
    
- **智能停播**：支持定时关闭（15-90min）及基于加速度计检测翻身频率的智能停播功能。
    
- **预设场景**：提供 4 套一键启动的经典混音预设。
    

### 2.2 AI 故事生成模块 (付费/激励点)

- **参数配置**：用户可选择主题（如：森林、星际）、音色、时长。
    
- **生成与播放**：
    
    - **短故事**：快速生成 300 字左右内容。
        
    - **长故事**：分段续写，支持流式加载，确保播放无感官卡顿。
        
- **15 秒试听**：确认音频满意后再消耗点数。
    

### 2.3 社区与分发 (正式版)

- **作品发布**：用户可将生成的优质故事发布至“浮境广场”。
    
- **广场浏览**：支持按“入睡成功率”、“热度”筛选他人创作的故事。
    

## 3. 非功能需求

- **性能要求**：
    
    - **首字响应时间 (TTFB)**：AI 生成后，第一段音频播出的延迟需控制在 3 秒内。
        
    - **并发性能**：后端单机支持 1000 DAU 级别的请求处理。
        
- **可用性**：UI 需适配夜间暗色模式，所有操作路径不超过 3 步。
    
- **稳定性**：音频引擎需在系统后台运行不被杀掉，且 8 轨混音时 CPU 占用率需低于 15%（中端机型）。
    

## 4. 用户界面需求

- **视觉风格**：极简深色调（Dark Mode），减少蓝光刺激，使用呼吸感动画。
    
- **交互逻辑**：
    
    - **全屏播放器**：支持全屏大面积手势操作（双击暂停、滑动音量）。
        
    - **折叠设计**：高级混音控制默认折叠，保持首屏洁净。
        

## 5. 系统架构

本系统采用云端协同架构：

- **客户端 (Flutter)**：负责音频混音逻辑、FFI 环形缓冲区处理、本地缓存。
    
- **服务端 (FastAPI)**：处理业务逻辑、用户额度管理、与 AI 模型对接。
    
- **AI 层**：
    
    - **LLM (Kimi/GLM-4)**：负责文本创作。
        
    - **TTS (阿里云/OpenAI)**：负责文字转语音。
        
- **基础设施**：使用轻量服务器 + 对象存储 (OSS) 存储氛围音静态素材。
    

## 6. 数据需求

- **用户数据**：ID、剩余额度、历史偏好设置。
    
- **音频素材**：高品质短音频循环片断（WAV/OGG 格式）。
    
- **持久化**：
    
    - **SQLite**：本地存储用户的混音预设和历史故事。
        
    - **PostgreSQL**：服务端存储社区共享数据及账单。
        

## 7. 接口需求

- **内部接口**：RESTful API 用于客户端与服务端的通信（JSON 格式）。
    
- **外部接口**：
    
    - **AI API**：智谱/Moonshot 文本生成接口。
        
    - **TTS API**：阿里云语音合成流式接口。
        
    - **激励广告 SDK**：穿山甲或优量汇广告接入。
        

## 8. 约束条件

- **技术约束**：必须兼容 Android 8.0+ 和 iOS 12+ 系统。
    
- **预算约束**：MVP 阶段每月运行成本需控制在 600 元人民币以内（基于 1000 DAU 测算）。
    
- **时间约束**：核心功能需在 4 周内完成开发并进入内测。
    
- **法律约束**：AI 生成内容需符合相关法律法规，需接入内容安全过滤（敏感词过滤）。
    